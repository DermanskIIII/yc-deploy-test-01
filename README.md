# yc-deploy-test-01
Тестовое задание:
1. Создать тестовую виртуальную машину в яндекс-облаке. 
2. Создать докер-образ на основе genotek/r-base, который будет содержать код веб приложения. 
3. Создать веб-приложение в докер-образе из п.2, которое в ответ на внешний http запрос исполняло бы элементарный системный shell скрипт (например, сообщающий системное время). При успешном исполнении shell–скрипта веб приложение должно вернуть http–статус 200 с результатом исполнения скрипта (например, системным временем), при ошибке должен быть возвращен http status 500. Необходимо продемонстрировать оба сценария программным способом. Для веб-приложения можно использовать любой язык или платформу. 
4. Развернуть созданный в п.3 докер-образ в яндекс-облаке, следуя https://cloud.yandex.ru/docs/container-registry/quickstart/ 
5. Решением Задачи является ссылка на репозиторий в github.com, который содержит а) исходные коды веб-приложения и б) shell–скрипт (плюс приватно-передаваемые ключи, если понадобятся), автоматизирующий построение и разворачивание этого web-приложения в яндекс-облаке как в п.4.
===============================================================================================

ВМ для которой выполнялось и проверялось задание в Я.Облаке развёрута из ОС "Debian OS Login 11" (так оно называется в каталоге Я.О)

Веб-приложение написано на python3 (проверялось для 3.8, 3.11)
Скрипт для bash вызывает утилиту date, но не чаще 1 раза в 5 секунд, иначе завершается с кодом 1
HTTP-сервер на Python слушает 80 порт, он упаковывается в образ, указанные endpoint или параметры GET-запроса
никак не влияют на работу приложения.


Основные шаги деплоя в скрипте:
 - Установка пакетов и утилиты Yandex Cloud
 - Клонирование репозитория(этого)
 - Настойка доступа в Yandex Cloud
 - Создание реестра образов
 - Сборка образа
 - Загрузка образа в реестр
 - Старт контейнераж. Флагом ``--restart always`` реализован автозапуск при загрузке ОС и перезапуск в случае падения

Шаги проверки:
  1. Файлы deploy.sh из данного репозитория, загрузить на ВМ.
  2. Запустить deploy.sh от имени любого пользователя с правами sudo.
  3. В процессе выполнения скрипта понадобиться ввести OAuth-токен Я.Облака.
  4. При успешном выполнении контейнер будет запущен и выполнение скрипта прекратится.
  5. Запустить demo.sh из домашней директории пользователя 

Некоторая информация:
  - Клонировать репозиторий на ВМ вручную не требуется, он будет склонирован в процессе деплоя
  - Файл deploy-ключа будет также создан автоматически и удалён по завершении деплоя
  - Почему-то(?) не удалось передать нужные опции для git clone (GIT_SSH_COMMAND с указание файла ключа)
      поэтому используется изменение конфигурации git пользователя (git config --global), после клонирования
      восстанавливаютс старые опции
  - Общая информация о ходе установки выводится в скрипте deploy.sh. Объемные выводы были скрыты, кроме сборки и push образа, так как они весьма долгие и желательно видеть что процесс продолжается.

Дополнение:
  В репозитории нет чувствительных данных, так что можно было сделать его публичным сразу и не добавлять ключ деплоя. Но я сначала сделал его приватным, а в последствии решил оставить эту часть -- так или иначе, это скорее хорошая практика.
